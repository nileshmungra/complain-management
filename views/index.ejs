<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Complaint Management</title>
  <link rel="stylesheet" href="/css/style.css"> <!-- Link to custom CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> <!-- Font Awesome -->
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <h1>Complaint Management</h1>
    </header>

    <!-- Navigation Buttons -->
    <div class="nav-buttons">
      <a href="/add" class="btn btn-primary">Add New Complaint</a>
      <a href="/replacement-report" class="btn btn-secondary">Replacement Report</a>
    </div>
	

    <!-- Excel Upload Section -->
    <section class="excel-upload-section">

	<div class="upload-container">
       
		<a href="/download-sample-excel" class="btn btn-primary">Download Sample Excel File</a>    
        <div class="upload-and-search">
          <!-- Excel Upload Form -->
          <form action="/upload-excel" method="POST" enctype="multipart/form-data" class="upload-form">
            
            <input type="file" id="excelFile" name="excelFile" accept=".xlsx, .xls" required>
            <button type="submit" class="btn btn-upload">
              <i class="fas fa-cloud-upload-alt"></i> Upload
            </button>
          </form>

          <!-- Search Section -->
          <div class="search-container">
            <input type="text" id="searchInput" class="search-input" placeholder="Search by Farmer, Dealer, or Area Manager" >
            <button type="button" class="btn btn-search" onclick="searchData()">
              <i class="fas fa-search"></i> Search
            </button>
            <button type="button" class="btn btn-clear" onclick="clearSearch()">
              <i class="fas fa-times"></i> Clear Search
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Complaint List Section -->
    <section class="complaints-section">
	<div class="table-scroll">
	
      <div class="pagination-controls">
        <label for="pageSize">Records per page:</label>
        <select id="pageSize" onchange="updatePageSize()">
          <option value="10" <%= pageSize === 10 ? "selected" : "" %>>10</option>
          <option value="50" <%= pageSize === 50 ? "selected" : "" %>>50</option>
          <option value="100" <%= pageSize === 100 ? "selected" : "" %>>100</option>
          <option value="all" <%= pageSize === "all" ? "selected" : "" %>>All</option>
        </select>
      </div>

      <table id="dataTable" class="complaints-table">
        <thead>
          <tr>
            <th>Sr. No</th>
            <th>Farmer Name</th>
            <th>Complaint Brief</th>
            <th>Material Supply Date</th>
            <th>Complaint Date</th>
            <th>Solve Date</th>
            <th>Close Date</th>
            <th>Complaint Type</th>
            <th>Dealer Name</th>
            <th>Area Manager</th>
            <th>Status</th>
            <th>Solution Description</th>
            <th>Replacement Received</th>
            <th>Actions</th>
            <th>Uploaded Documents</th>
          </tr>
        </thead>
        <tbody>
          <% if (complaints.length > 0) { %>
            <% complaints.forEach((complaint, index) => { %>
              <tr>
                <td><%= complaint.srno %></td>
                <td><%= complaint.farmerName || "N/A" %></td>
                <td><%= complaint.complaintBrief || "N/A" %></td>
                <td><%= complaint.materialSupplyDate || "N/A" %></td>
                <td><%= complaint.complainDate || "N/A" %></td>
                <td><%= complaint.solveDate || "N/A" %></td>
                <td><%= complaint.closeDate || "N/A" %></td>
                <td><%= complaint.complainType || "N/A" %></td>
                <td><%= complaint.dealerName || "N/A" %></td>
                <td><%= complaint.areaManager || "N/A" %></td>
                <td><%= complaint.status || "Pending" %></td>
                <td><%= complaint.solutionDescription  %></td>
                <td><%= complaint.replacementReceived || "No" %></td>
                <td>
                  <a href="/edit/<%= complaint.srno %>" class="btn btn-edit">
					<i class="fas fa-edit"></i>
				  </a>
                  <a href="/delete/<%= complaint.srno %>" class="btn btn-delete" onclick="return confirmDelete();">
					<i class="fas fa-trash"></i>
				  </a>
                </td>
                <td>
                  <% if (complaint.complainForm) { %>
                    <a href="/uploads/<%= complaint.complainForm %>" target="_blank" title="View Complain Form">
                      <i class="fas fa-file-alt fa-2x"></i>
                    </a>
                  <% } %>
                  <% if (complaint.photo) { %>
                    <% complaint.photo.split(",").forEach(photo => { %>
                      <a href="/uploads/<%= photo.trim() %>" target="_blank" title="View Photo">
                        <i class="fas fa-image fa-2x"></i>
                      </a>
                    <% }); %>
                  <% } %>
                  <% if (complaint.video) { %>
                    <% complaint.video.split(",").forEach(video => { %>
                      <a href="/uploads/<%= video.trim() %>" target="_blank" title="View Video">
                        <i class="fas fa-video fa-2x"></i>
                      </a>
                    <% }); %>
                  <% } %>
                </td>
              </tr>
            <% }); %>
          <% } else { %>
            <tr>
              <td colspan="14">No complaints found. Please upload a file or add a new complaint.</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </section>
</div>
    <!-- Pagination Links -->
    <div class="pagination-links">
      <% if (currentPage > 1) { %>
        <a href="/?page=<%= currentPage - 1 %>&pageSize=<%= pageSize %>" class="btn btn-prev">Previous</a>
      <% } %>
      <% if (!isLastPage) { %>
        <a href="/?page=<%= currentPage + 1 %>&pageSize=<%= pageSize %>" class="btn btn-next">Next</a>
      <% } %>
    </div>

    <!-- Scripts -->
    <script>
      function searchData() {
        const input = document.getElementById("searchInput").value.toLowerCase();
        const rows = document.querySelectorAll("#dataTable tbody tr");

        rows.forEach(row => {
          const cells = row.querySelectorAll("td");
          const matches = Array.from(cells).some(cell => cell.textContent.toLowerCase().includes(input));
          row.style.display = matches ? "" : "none";
        });
      }

      function clearSearch() {
        document.getElementById("searchInput").value = "";
        searchData();
      }

      function updatePageSize() {
        const pageSize = document.getElementById("pageSize").value;
        window.location.href = `/?page=1&pageSize=${pageSize}`;
      }
	  
	  function confirmDelete() {
		return confirm("Are you sure you want to delete this complaint? This action cannot be undone.");
	  }
    </script>
  </div>
</body>
</html>
